import{a as U}from"./chunk-BJ3VZH2X.js";import{c as z,d as I,e as L,f as F,g as H,h as j,p as W,r as B}from"./chunk-V4S5BHXF.js";import{a as R}from"./chunk-IY34DK4E.js";import{Ab as w,Bb as C,Bc as G,Ca as a,Ha as k,Ma as V,Qa as _,Xa as b,aa as d,ba as p,ca as f,da as g,db as t,eb as i,fb as c,gc as N,ic as P,jb as E,kb as v,lb as l,uc as T,vb as o,xb as S,zb as x}from"./chunk-YGAPY4LI.js";import"./chunk-LMZWYZYD.js";import{h as A,j as y}from"./chunk-K4ALXBGI.js";var h=A(R());function q(u,n){u&1&&(t(0,"p",49),f(),t(1,"svg",50),c(2,"path",51),i(),o(3," Las contrase\xF1as no coinciden. "),i())}function D(u,n){if(u&1){let e=E();t(0,"div",22)(1,"div",23)(2,"div",24)(3,"h2",25),o(4,"Editar Perfil"),i(),t(5,"p",26),o(6,"Actualiza tu informaci\xF3n personal"),i()(),t(7,"button",27),v("click",function(){d(e);let r=l(2);return p(r.cerrarModal())}),o(8," \u2716 "),i(),t(9,"form",28),v("ngSubmit",function(){d(e);let r=l(2);return p(r.guardarCambios())}),t(10,"div")(11,"label",29),o(12,"Nombre"),i(),t(13,"div",30)(14,"div",31),f(),t(15,"svg",32),c(16,"path",20),i()(),g(),t(17,"input",33),C("ngModelChange",function(r){d(e);let m=l(2);return w(m.nuevoNombre,r)||(m.nuevoNombre=r),p(r)}),i()()(),t(18,"div")(19,"label",34),o(20,"Email"),i(),t(21,"div",30)(22,"div",35),f(),t(23,"svg",32),c(24,"path",14),i()(),g(),t(25,"input",36),C("ngModelChange",function(r){d(e);let m=l(2);return w(m.nuevoEmail,r)||(m.nuevoEmail=r),p(r)}),i()()(),t(26,"div")(27,"label",37),o(28,"Nueva Contrase\xF1a"),i(),t(29,"div",30)(30,"div",38),f(),t(31,"svg",32),c(32,"path",39),i()(),g(),t(33,"input",40),C("ngModelChange",function(r){d(e);let m=l(2);return w(m.nuevaContrasenia,r)||(m.nuevaContrasenia=r),p(r)}),i(),t(34,"button",41),v("click",function(){d(e);let r=l(2);return p(r.verContrasenia=!r.verContrasenia)}),c(35,"i",42),i()()(),t(36,"div")(37,"label",43),o(38,"Confirmar Contrase\xF1a"),i(),t(39,"div",30)(40,"div",38),f(),t(41,"svg",32),c(42,"path",44),i()(),g(),t(43,"input",45),C("ngModelChange",function(r){d(e);let m=l(2);return w(m.confirmacionContrasenia,r)||(m.confirmacionContrasenia=r),p(r)}),i(),t(44,"button",46),v("click",function(){d(e);let r=l(2);return p(r.verConfirmacion=!r.verConfirmacion)}),c(45,"i",42),i()()(),_(46,q,4,0,"p",47),t(47,"button",48),o(48," Guardar Cambios "),i()()()()}if(u&2){let e=l(2);a(17),x("ngModel",e.nuevoNombre),a(8),x("ngModel",e.nuevoEmail),a(8),b("type",e.verContrasenia?"text":"password"),x("ngModel",e.nuevaContrasenia),a(2),b("ngClass",e.verContrasenia?"bi-eye-slash":"bi-eye"),a(8),b("type",e.verConfirmacion?"text":"password"),x("ngModel",e.confirmacionContrasenia),a(2),b("ngClass",e.verConfirmacion?"bi-eye-slash":"bi-eye"),a(),b("ngIf",e.nuevaContrasenia!==e.confirmacionContrasenia),a(),b("disabled",e.nuevaContrasenia!==e.confirmacionContrasenia||!e.nuevoNombre||!e.nuevoEmail)}}function O(u,n){if(u&1){let e=E();t(0,"div",1)(1,"div",2)(2,"h2",3)(3,"div",4),o(4),i(),t(5,"span",5),o(6,"Mi perfil"),i()(),t(7,"button",6),v("click",function(){d(e);let r=l();return p(r.editarPerfil())}),f(),t(8,"svg",7),c(9,"path",8),i(),o(10," Editar "),i()(),g(),t(11,"div",9)(12,"div",10)(13,"div",11)(14,"div",12),f(),t(15,"svg",13),c(16,"path",14),i()(),g(),t(17,"div",15)(18,"p",16),o(19,"Email"),i(),t(20,"p",17),o(21),i()()(),t(22,"div",11)(23,"div",18),f(),t(24,"svg",19),c(25,"path",20),i()(),g(),t(26,"div",15)(27,"p",16),o(28,"Nombre"),i(),t(29,"p",17),o(30),i()()()()(),_(31,D,49,10,"div",21),i()}if(u&2){let e=l();a(4),S(" ",(e.perfil==null||e.perfil.nombre==null?null:e.perfil.nombre.charAt(0))||"U"," "),a(17),S(" ",e.usuario.email," "),a(9),S(" ",e.perfil==null?null:e.perfil.nombre," "),a(),b("ngIf",e.editandoPerfil)}}var M=class u{constructor(n,e){this.supabaseService=n;this.userService=e}usuario=null;perfil=null;exito=null;error=null;nuevaContrasenia="";confirmacionContrasenia="";verContrasenia=!1;verConfirmacion=!1;editandoPerfil=!1;nuevoNombre="";nuevoEmail="";ngOnInit(){return y(this,null,function*(){try{if(!(yield this.supabaseService.waitForSessionRestoration())){console.log("No hay sesi\xF3n activa despu\xE9s de esperar");return}if(this.usuario=yield this.supabaseService.getUsuarioActual(),!this.usuario){console.log("Usuario no encontrado");return}this.perfil=yield this.supabaseService.obtenerPerfilDeUsuario(this.usuario.id),this.perfil&&(this.userService.setNombreUsuario(this.perfil.nombre),this.userService.setRolUsuario(this.perfil.rol))}catch(n){console.error("Error:",n)}})}editarPerfil(){this.editandoPerfil=!0,this.nuevoNombre=this.perfil?.nombre||"",this.nuevoEmail=this.usuario?.email||""}guardarCambios(){return y(this,null,function*(){let n=!1;try{if(this.nuevaContrasenia||this.confirmacionContrasenia){if(this.nuevaContrasenia!==this.confirmacionContrasenia){h.default.fire({icon:"error",title:"Error",text:"Las contrase\xF1as no coinciden."});return}let e=yield this.supabaseService.cambiarContrase\u00F1a(this.nuevaContrasenia);if(e.error)throw new Error(typeof e.error=="string"?e.error:e.error.message||"Error al cambiar la contrase\xF1a.");n=!0}if(this.perfil.nombre.trim()!==this.nuevoNombre.trim()&&(yield this.supabaseService.actualizarPerfil(this.usuario.id,{nombre:this.nuevoNombre}),this.perfil.nombre=this.nuevoNombre,this.userService.setNombreUsuario(this.nuevoNombre),n=!0),this.usuario.email!==this.nuevoEmail){let e=yield this.supabaseService.cambiarCorreo(this.nuevoEmail);if(e.message&&e.message!=="")h.default.fire({icon:"success",title:"\xA1Correo electr\xF3nico actualizado!",text:"Verifica tu nuevo correo electr\xF3nico."}),this.usuario.email=this.nuevoEmail,n=!0;else throw new Error("Hubo un error al actualizar el correo electr\xF3nico.")}n?(h.default.fire({icon:"success",title:"\xA1Cambios guardados!",text:"Tu perfil se actualiz\xF3 correctamente.",timer:2500,toast:!0,showConfirmButton:!1,position:"top-end"}),this.editandoPerfil=!1):h.default.fire({icon:"info",title:"Sin cambios",text:"No realizaste ning\xFAn cambio."})}catch(e){h.default.fire({icon:"error",title:"Error",text:e.message||"Hubo un error al guardar los cambios."})}})}cambiarContrasenia(){return y(this,null,function*(){if(this.nuevaContrasenia!==this.confirmacionContrasenia){this.error="Las contrase\xF1as no coinciden.";return}try{let n=yield this.supabaseService.cambiarContrase\u00F1a(this.nuevaContrasenia);n.error?this.error=n.error:this.exito="Contrase\xF1a actualizada correctamente."}catch(n){console.error("Error al cambiar la contrase\xF1a:",n.message),this.error="Hubo un error al cambiar la contrase\xF1a."}})}togglePasswordVisibility(n){let e=document.getElementById(n);e.type=e.type==="password"?"text":"password"}cerrarModal(){this.editandoPerfil=!1,this.nuevoNombre=this.perfil?.nombre||"",this.nuevoEmail=this.usuario?.email||"",this.nuevaContrasenia="",this.confirmacionContrasenia="",this.exito=null,this.error=null}static \u0275fac=function(e){return new(e||u)(k(G),k(U))};static \u0275cmp=V({type:u,selectors:[["app-perfil"]],decls:1,vars:1,consts:[["class","max-w-4xl w-full mx-auto p-6 md:p-8 bg-white shadow-2xl rounded-2xl my-8 border border-gray-200",4,"ngIf"],[1,"max-w-4xl","w-full","mx-auto","p-6","md:p-8","bg-white","shadow-2xl","rounded-2xl","my-8","border","border-gray-200"],[1,"flex","flex-wrap","items-center","justify-between","mb-10","border-b","pb-6","border-gray-300"],[1,"text-3xl","font-bold","text-gray-900","flex","items-center","min-w-0"],[1,"bg-orange-500","text-white","rounded-full","h-10","w-10","flex","items-center","justify-center","mr-3","font-semibold","uppercase","flex-shrink-0"],[1,"truncate"],[1,"flex","items-center","px-4","py-2","bg-yellow-400","text-black","font-semibold","rounded-lg","hover:bg-yellow-500","transition","focus:ring-2","focus:ring-yellow-300","cursor-pointer","mt-4","md:mt-0",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-5","w-5","mr-2"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15.232 5.232l3.536 3.536M9 13h6l3 3H6l3-3z"],[1,"bg-gray-50","rounded-xl","p-6","shadow-inner","border","border-gray-200"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-6"],[1,"flex","items-center","space-x-4","min-w-0"],[1,"bg-yellow-100","p-3","rounded-full","flex-shrink-0"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-6","w-6","text-yellow-500"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"],[1,"min-w-0"],[1,"text-sm","text-gray-500","whitespace-normal"],[1,"text-lg","font-medium","text-gray-900","break-words","truncate","max-w-full","w-full","whitespace-normal"],[1,"bg-orange-100","p-3","rounded-full","flex-shrink-0"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-6","w-6","text-orange-500"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"],["class","fixed inset-0 bg-black/30 backdrop-blur-md backdrop-saturate-150 flex justify-center items-center z-50 p-4",4,"ngIf"],[1,"fixed","inset-0","bg-black/30","backdrop-blur-md","backdrop-saturate-150","flex","justify-center","items-center","z-50","p-4"],[1,"bg-white","text-black","rounded-xl","shadow-2xl","max-w-md","w-full","relative","overflow-hidden","border","border-gray-200"],[1,"bg-orange-500","p-5","text-white","rounded-t-xl"],[1,"text-2xl","font-bold","truncate"],[1,"text-orange-100","whitespace-normal"],["aria-label","Cerrar modal",1,"absolute","top-3","right-3","text-white","hover:text-yellow-300","transition","cursor-pointer",3,"click"],["novalidate","",1,"p-6","bg-white","space-y-5",3,"ngSubmit"],["for","nuevoNombre",1,"block","text-gray-800","font-medium","mb-1","whitespace-normal"],[1,"relative"],[1,"absolute","left-3","top-1/2","transform","-translate-y-1/2","text-orange-400","pointer-events-none"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],["type","text","id","nuevoNombre","name","nuevoNombre","required","","placeholder","Tu nombre completo",1,"w-full","pl-10","pr-4","py-3","border","border-orange-300","rounded-lg","focus:outline-none","focus:ring-2","focus:ring-orange-500","break-words","whitespace-normal",3,"ngModelChange","ngModel"],["for","nuevoEmail",1,"block","text-gray-800","font-medium","mb-1","whitespace-normal"],[1,"absolute","left-3","top-1/2","transform","-translate-y-1/2","text-yellow-400","pointer-events-none"],["type","email","id","nuevoEmail","name","nuevoEmail","required","","readonly","","placeholder","correo@ejemplo.com",1,"w-full","pl-10","pr-4","py-3","border","border-yellow-300","rounded-lg","bg-gray-100","text-gray-700","cursor-not-allowed","break-words","whitespace-normal",3,"ngModelChange","ngModel"],["for","nuevaContrase\xF1a",1,"block","text-gray-800","font-medium","mb-1","whitespace-normal"],[1,"absolute","left-3","top-1/2","transform","-translate-y-1/2","text-gray-400","pointer-events-none"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"],["id","nuevaContrase\xF1a","name","nuevaContrasenia","required","","placeholder","\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022",1,"w-full","pl-10","pr-10","py-3","border","border-gray-300","rounded-lg","focus:outline-none","focus:ring-2","focus:ring-orange-400","break-words","whitespace-normal",3,"ngModelChange","type","ngModel"],["type","button","title","Ver contrase\xF1a",1,"absolute","right-3","top-1/2","transform","-translate-y-1/2","text-gray-500","focus:outline-none",3,"click"],[1,"bi",3,"ngClass"],["for","confirmacionContrase\xF1a",1,"block","text-gray-800","font-medium","mb-1","whitespace-normal"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"],["id","confirmacionContrase\xF1a","name","confirmacionContrase\xF1a","required","","placeholder","\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022",1,"w-full","pl-10","pr-10","py-3","border","border-gray-300","rounded-lg","focus:outline-none","focus:ring-2","focus:ring-yellow-400","break-words","whitespace-normal",3,"ngModelChange","type","ngModel"],["type","button","title","Ver confirmaci\xF3n",1,"absolute","right-3","top-1/2","transform","-translate-y-1/2","text-gray-500","focus:outline-none",3,"click"],["class","text-red-600 text-sm flex items-center whitespace-normal break-words",4,"ngIf"],["type","submit",1,"w-full","py-3","bg-yellow-400","hover:bg-yellow-500","disabled:opacity-50","disabled:cursor-not-allowed","text-black","font-semibold","rounded-lg","transition","focus:ring-2","focus:ring-yellow-300",3,"disabled"],[1,"text-red-600","text-sm","flex","items-center","whitespace-normal","break-words"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"h-5","w-5","mr-1","flex-shrink-0"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M18.364 5.636l-12.728 12.728M6 18h.01M18 6h.01"]],template:function(e,s){e&1&&_(0,O,32,4,"div",0),e&2&&b("ngIf",s.usuario&&s.perfil)},dependencies:[T,N,P,B,j,z,I,L,W,H,F],encapsulation:2})};export{M as default};
