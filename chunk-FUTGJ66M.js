import{a as A}from"./chunk-BJ3VZH2X.js";import{c as z,d as I,e as j,f as F,g as H,h as B,p as W,r as G}from"./chunk-V4S5BHXF.js";import{a as q}from"./chunk-IY34DK4E.js";import{Ab as _,Bb as C,Bc as U,Ca as a,Ha as S,Ma as V,Qa as y,Xa as g,aa as u,ba as d,ca as f,da as v,db as t,eb as i,fb as m,gc as N,ic as T,jb as E,kb as b,lb as l,uc as L,vb as o,wb as k,xb as P,zb as h}from"./chunk-YGAPY4LI.js";import"./chunk-LMZWYZYD.js";import{h as R,j as w}from"./chunk-K4ALXBGI.js";var x=R(q());function D(p,n){p&1&&(t(0,"p",51),f(),t(1,"svg",52),m(2,"path",53),i(),o(3," Las contrase\xF1as no coinciden. "),i())}function O(p,n){if(p&1){let e=E();t(0,"div",20)(1,"div",21)(2,"div",22)(3,"h2",23),o(4,"Editar Perfil"),i(),t(5,"p",24),o(6,"Actualiza tu informaci\xF3n personal"),i()(),t(7,"button",25),b("click",function(){u(e);let r=l(2);return d(r.cerrarModal())}),o(8," \u2716 "),i(),t(9,"form",26),b("ngSubmit",function(){u(e);let r=l(2);return d(r.guardarCambios())}),t(10,"div")(11,"label",27),o(12,"Nombre"),i(),t(13,"div",28)(14,"div",29),f(),t(15,"svg",30),m(16,"path",18),i()(),v(),t(17,"input",31),C("ngModelChange",function(r){u(e);let c=l(2);return _(c.nuevoNombre,r)||(c.nuevoNombre=r),d(r)}),i()()(),t(18,"div")(19,"label",32),o(20,"Email"),i(),t(21,"div",28)(22,"div",33),f(),t(23,"svg",30),m(24,"path",13),i()(),v(),t(25,"input",34),C("ngModelChange",function(r){u(e);let c=l(2);return _(c.nuevoEmail,r)||(c.nuevoEmail=r),d(r)}),i()()(),t(26,"div")(27,"label",35),o(28,"Nueva Contrase\xF1a"),i(),t(29,"div",28)(30,"div",36),f(),t(31,"svg",30),m(32,"path",37),i()(),v(),t(33,"input",38),C("ngModelChange",function(r){u(e);let c=l(2);return _(c.nuevaContrasenia,r)||(c.nuevaContrasenia=r),d(r)}),i(),t(34,"button",39),b("click",function(){u(e);let r=l(2);return d(r.verContrasenia=!r.verContrasenia)}),m(35,"i",40),i()()(),t(36,"div")(37,"label",41),o(38,"Confirmar Contrase\xF1a"),i(),t(39,"div",28)(40,"div",36),f(),t(41,"svg",30),m(42,"path",42),i()(),v(),t(43,"input",43),C("ngModelChange",function(r){u(e);let c=l(2);return _(c.confirmacionContrasenia,r)||(c.confirmacionContrasenia=r),d(r)}),i(),t(44,"button",44),b("click",function(){u(e);let r=l(2);return d(r.verConfirmacion=!r.verConfirmacion)}),m(45,"i",40),i()()(),y(46,D,4,0,"p",45),t(47,"div",46)(48,"button",47),b("click",function(){u(e);let r=l(2);return d(r.cerrarModal())}),o(49," Cancelar "),i(),t(50,"button",48),f(),t(51,"svg",49),m(52,"path",50),i(),o(53," Guardar Cambios "),i()()()()()}if(p&2){let e=l(2);a(17),h("ngModel",e.nuevoNombre),a(8),h("ngModel",e.nuevoEmail),a(8),g("type",e.verContrasenia?"text":"password"),h("ngModel",e.nuevaContrasenia),a(2),g("ngClass",e.verContrasenia?"bi-eye-slash":"bi-eye"),a(8),g("type",e.verConfirmacion?"text":"password"),h("ngModel",e.confirmacionContrasenia),a(2),g("ngClass",e.verConfirmacion?"bi-eye-slash":"bi-eye"),a(),g("ngIf",e.nuevaContrasenia!==e.confirmacionContrasenia),a(4),g("disabled",e.nuevaContrasenia!==e.confirmacionContrasenia)}}function J(p,n){if(p&1){let e=E();t(0,"div",1)(1,"div",2)(2,"h2",3)(3,"div",4),o(4),i(),o(5," Mi perfil "),i(),t(6,"button",5),b("click",function(){u(e);let r=l();return d(r.editarPerfil())}),f(),t(7,"svg",6),m(8,"path",7),i(),o(9," Editar "),i()(),v(),t(10,"div",8)(11,"div",9)(12,"div",10)(13,"div",11),f(),t(14,"svg",12),m(15,"path",13),i()(),v(),t(16,"div")(17,"p",14),o(18,"Email"),i(),t(19,"p",15),o(20),i()()(),t(21,"div",10)(22,"div",16),f(),t(23,"svg",17),m(24,"path",18),i()(),v(),t(25,"div")(26,"p",14),o(27,"Nombre"),i(),t(28,"p",15),o(29),i()()()()(),y(30,O,54,10,"div",19),i()}if(p&2){let e=l();a(4),P(" ",(e.perfil==null||e.perfil.nombre==null?null:e.perfil.nombre.charAt(0))||"U"," "),a(16),k(e.usuario.email),a(9),k(e.perfil==null?null:e.perfil.nombre),a(),g("ngIf",e.editandoPerfil)}}var M=class p{constructor(n,e){this.supabaseService=n;this.userService=e}usuario=null;perfil=null;exito=null;error=null;nuevaContrasenia="";confirmacionContrasenia="";verContrasenia=!1;verConfirmacion=!1;editandoPerfil=!1;nuevoNombre="";nuevoEmail="";ngOnInit(){return w(this,null,function*(){try{if(!(yield this.supabaseService.waitForSessionRestoration())){console.log("No hay sesi\xF3n activa despu\xE9s de esperar");return}if(this.usuario=yield this.supabaseService.getUsuarioActual(),!this.usuario){console.log("Usuario no encontrado");return}this.perfil=yield this.supabaseService.obtenerPerfilDeUsuario(this.usuario.id),this.perfil&&(this.userService.setNombreUsuario(this.perfil.nombre),this.userService.setRolUsuario(this.perfil.rol))}catch(n){console.error("Error:",n)}})}editarPerfil(){this.editandoPerfil=!0,this.nuevoNombre=this.perfil?.nombre||"",this.nuevoEmail=this.usuario?.email||""}guardarCambios(){return w(this,null,function*(){let n=!1;try{if(this.nuevaContrasenia||this.confirmacionContrasenia){if(this.nuevaContrasenia!==this.confirmacionContrasenia){x.default.fire({icon:"error",title:"Error",text:"Las contrase\xF1as no coinciden."});return}let e=yield this.supabaseService.cambiarContrase\u00F1a(this.nuevaContrasenia);if(e.error)throw new Error(typeof e.error=="string"?e.error:e.error.message||"Error al cambiar la contrase\xF1a.");n=!0}if(this.perfil.nombre.trim()!==this.nuevoNombre.trim()&&(yield this.supabaseService.actualizarPerfil(this.usuario.id,{nombre:this.nuevoNombre}),this.perfil.nombre=this.nuevoNombre,this.userService.setNombreUsuario(this.nuevoNombre),n=!0),this.usuario.email!==this.nuevoEmail){let e=yield this.supabaseService.cambiarCorreo(this.nuevoEmail);if(e.message&&e.message!=="")x.default.fire({icon:"success",title:"\xA1Correo electr\xF3nico actualizado!",text:"Verifica tu nuevo correo electr\xF3nico."}),this.usuario.email=this.nuevoEmail,n=!0;else throw new Error("Hubo un error al actualizar el correo electr\xF3nico.")}n?(x.default.fire({icon:"success",title:"\xA1Cambios guardados!",text:"Tu perfil se actualiz\xF3 correctamente.",timer:2500,toast:!0,showConfirmButton:!1,position:"top-end"}),this.editandoPerfil=!1):x.default.fire({icon:"info",title:"Sin cambios",text:"No realizaste ning\xFAn cambio."})}catch(e){x.default.fire({icon:"error",title:"Error",text:e.message||"Hubo un error al guardar los cambios."})}})}cambiarContrasenia(){return w(this,null,function*(){if(this.nuevaContrasenia!==this.confirmacionContrasenia){this.error="Las contrase\xF1as no coinciden.";return}try{let n=yield this.supabaseService.cambiarContrase\u00F1a(this.nuevaContrasenia);n.error?this.error=n.error:this.exito="Contrase\xF1a actualizada correctamente."}catch(n){console.error("Error al cambiar la contrase\xF1a:",n.message),this.error="Hubo un error al cambiar la contrase\xF1a."}})}togglePasswordVisibility(n){let e=document.getElementById(n);e.type=e.type==="password"?"text":"password"}cerrarModal(){this.editandoPerfil=!1,this.nuevoNombre=this.perfil?.nombre||"",this.nuevoEmail=this.usuario?.email||"",this.nuevaContrasenia="",this.confirmacionContrasenia="",this.exito=null,this.error=null}static \u0275fac=function(e){return new(e||p)(S(U),S(A))};static \u0275cmp=V({type:p,selectors:[["app-perfil"]],decls:1,vars:1,consts:[["class","max-w-4xl mx-auto p-8 bg-white shadow-2xl rounded-2xl my-8 border border-gray-200",4,"ngIf"],[1,"max-w-4xl","mx-auto","p-8","bg-white","shadow-2xl","rounded-2xl","my-8","border","border-gray-200"],[1,"flex","items-center","justify-between","mb-10","border-b","pb-6","border-gray-300"],[1,"text-3xl","font-bold","text-gray-900","flex","items-center"],[1,"bg-orange-500","text-white","rounded-full","h-10","w-10","flex","items-center","justify-center","mr-3","font-semibold","uppercase"],[1,"flex","items-center","px-4","py-2","bg-yellow-400","text-black","font-semibold","rounded-lg","hover:bg-yellow-500","transition","focus:ring-2","focus:ring-yellow-300","cursor-pointer",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-5","w-5","mr-2"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15.232 5.232l3.536 3.536M9 13h6l3 3H6l3-3z"],[1,"bg-gray-50","rounded-xl","p-6","shadow-inner","border","border-gray-200"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-6"],[1,"flex","items-center","space-x-4"],[1,"bg-yellow-100","p-3","rounded-full"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-6","w-6","text-yellow-500"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"],[1,"text-sm","text-gray-500"],[1,"text-lg","font-medium","text-gray-900"],[1,"bg-orange-100","p-3","rounded-full"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-6","w-6","text-orange-500"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"],["class","fixed inset-0 bg-black/30 backdrop-blur-md backdrop-saturate-150 flex justify-center items-center z-50 p-4",4,"ngIf"],[1,"fixed","inset-0","bg-black/30","backdrop-blur-md","backdrop-saturate-150","flex","justify-center","items-center","z-50","p-4"],[1,"bg-white","text-black","rounded-xl","shadow-2xl","max-w-md","w-full","relative","overflow-hidden","border","border-gray-200"],[1,"bg-orange-500","p-5","text-white","rounded-t-xl"],[1,"text-2xl","font-bold"],[1,"text-orange-100"],[1,"absolute","top-3","right-3","text-white","hover:text-yellow-300","transition","cursor-pointer",3,"click"],[1,"p-6","bg-white","space-y-5",3,"ngSubmit"],["for","nuevoNombre",1,"block","text-gray-800","font-medium","mb-1"],[1,"relative"],[1,"absolute","left-3","top-1/2","transform","-translate-y-1/2","text-orange-400"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],["type","text","id","nuevoNombre","name","nuevoNombre","required","","placeholder","Tu nombre completo",1,"w-full","pl-10","pr-4","py-3","border","border-orange-300","rounded-lg","focus:outline-none","focus:ring-2","focus:ring-orange-500",3,"ngModelChange","ngModel"],["for","nuevoEmail",1,"block","text-gray-800","font-medium","mb-1"],[1,"absolute","left-3","top-1/2","transform","-translate-y-1/2","text-yellow-400"],["type","email","id","nuevoEmail","name","nuevoEmail","required","","readonly","","placeholder","correo@ejemplo.com",1,"w-full","pl-10","pr-4","py-3","border","border-yellow-300","rounded-lg","bg-gray-100","text-gray-700","cursor-not-allowed",3,"ngModelChange","ngModel"],["for","nuevaContrase\xF1a",1,"block","text-gray-800","font-medium","mb-1"],[1,"absolute","left-3","top-1/2","transform","-translate-y-1/2","text-gray-400"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"],["id","nuevaContrase\xF1a","name","nuevaContrase\xF1a","required","","placeholder","\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022",1,"w-full","pl-10","pr-10","py-3","border","border-gray-300","rounded-lg","focus:outline-none","focus:ring-2","focus:ring-orange-400",3,"ngModelChange","type","ngModel"],["type","button","title","ver",1,"absolute","right-3","top-1/2","transform","-translate-y-1/2","text-gray-500","focus:outline-none",3,"click"],[1,"bi",3,"ngClass"],["for","confirmacionContrase\xF1a",1,"block","text-gray-800","font-medium","mb-1"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"],["id","confirmacionContrase\xF1a","name","confirmacionContrase\xF1a","required","","placeholder","\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022",1,"w-full","pl-10","pr-10","py-3","border","border-gray-300","rounded-lg","focus:outline-none","focus:ring-2","focus:ring-yellow-400",3,"ngModelChange","type","ngModel"],["type","button","title","enviar",1,"absolute","right-3","top-1/2","transform","-translate-y-1/2","text-gray-500","focus:outline-none",3,"click"],["class","text-red-600 text-sm flex items-center",4,"ngIf"],[1,"flex","space-x-3","pt-4"],["type","button",1,"flex-1","py-3","bg-gray-100","text-gray-800","font-semibold","rounded-lg","hover:bg-gray-200","cursor-pointer",3,"click"],["type","submit",1,"flex-1","py-3","bg-orange-500","text-white","font-semibold","rounded-lg","hover:bg-orange-600","disabled:opacity-50","disabled:cursor-not-allowed","flex","items-center","justify-center","cursor-pointer",3,"disabled"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","mr-2"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M5 13l4 4L19 7"],[1,"text-red-600","text-sm","flex","items-center"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"h-5","w-5","mr-1"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"]],template:function(e,s){e&1&&y(0,J,31,4,"div",0),e&2&&g("ngIf",s.usuario&&s.perfil)},dependencies:[L,N,T,G,B,z,I,j,W,H,F],encapsulation:2})};export{M as default};
